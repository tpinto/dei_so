#include "lasttweet.h"#include <pthread.h>#define DEBUGtypedef struct {  char* content;  char* keyword;} tweet_t;static pthread_mutex_t using_buffer_mutex = PTHREAD_MUTEX_INITIALIZER;static pthread_t** threads;static tweet_t** tweets;static pthread_cond_t items = PTHREAD_COND_INITIALIZER;static pthread_cond_t slots = PTHREAD_COND_INITIALIZER;static int buffer_index;static int how_many_threads;void *Workout(void * k){  char * keyword = (char *) k;    #ifdef DEBUG    printf("Started to Workout()\n");  #endif  while(1){    #ifdef DEBUG      printf("Before lock on Workout()\n");    #endif        pthread_mutex_lock(&using_buffer_mutex);        #ifdef DEBUG      printf("buffer_index > 0 - %d > 0\n",buffer_index);    #endif        while(buffer_index > 0)      pthread_cond_wait(&slots, &using_buffer_mutex);          tweet_t* tweet = (tweet_t*) malloc(sizeof(tweet_t));    tweet->content = lasttweet(keyword);    tweet->keyword = keyword;        tweets[buffer_index] = tweet;    buffer_index = buffer_index + 1;          #ifdef DEBUG        printf("Before cond signal()\n");        printf("  buffer_index = %d\n", buffer_index);        printf("  tweet.content = %s\n", tweet->content);        printf("  tweet.keyword = %s\n", tweet->keyword);      #endif        pthread_cond_signal(&items);        #ifdef DEBUG      printf("Before unlock on Workout()\n");    #endif        pthread_mutex_unlock(&using_buffer_mutex);  }  pthread_exit(NULL);}int main (int argc, char const *argv[]){  how_many_threads = argc - 1;    #ifdef DEBUG    printf("Lets start %d threads\n", how_many_threads);  #endif    threads = malloc(how_many_threads*sizeof(pthread_t));  tweets = malloc(how_many_threads*sizeof(tweet_t));      buffer_index = 0;  int i;  pthread_t* thread;  for(i=1;i<argc;i++){    #ifdef DEBUG      printf("Creating thread #%d for keyword '%s'\n",i,argv[i]);    #endif    pthread_create(thread, NULL, Workout, (void *) argv[i]);        threads[i] = thread;        #ifdef DEBUG      printf("Created thread #%d for keyword '%s'\n",i,argv[i]);    #endif  }    #ifdef DEBUG    printf("Before lock on main()\n");  #endif    pthread_mutex_lock(&using_buffer_mutex);    #ifdef DEBUG    printf("buffer_index < how_many_threads - %d < %d\n",buffer_index,how_many_threads);  #endif    while(buffer_index < how_many_threads)    pthread_cond_wait(&items, &using_buffer_mutex);      tweet_t* tweet = (tweet_t*) malloc(sizeof(tweet_t));  tweet = tweets[buffer_index];  buffer_index = buffer_index - 1;    printf("tweet for '%s': %s", tweet->keyword, tweet->content);    pthread_cond_signal(&slots);    #ifdef DEBUG    printf("Before unlock on main()\n");  #endif    pthread_mutex_unlock(&using_buffer_mutex);  return 0;}